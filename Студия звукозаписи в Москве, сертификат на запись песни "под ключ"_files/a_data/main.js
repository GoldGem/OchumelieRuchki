var wixInstagramApp=(function App(){var b=new Mediator();var d={header:"#header",followBlock:"#follow_block",main:"#main",grid:".grid",layout:"#layout",aside:"#aside",sideHeader:"#side_header",previewBlock:"#preview_wrapper",popupSection:"#popup_section",previewSection:"#preview_section",mainImageWrapper:".main_image_wrapper",preview:".preview",previewInfo:"#preview_info",previewImage:"#preview_image",previewVideo:".video_preview",mediaInfoBlock:"#media_info",descriptionBlock:"#description",galleryBlock:".thumb_gallery_wrapper",gallery:".thumb_gallery",thumbnail:".thumb_image",thumbImage:".thumb_image_item",imageGallery:".image_gallery",videoButton:".video_preview .play",videoContainer:"#video_container",video:"#video_element",commentsBlock:"#comments",showMoreCommentsBlock:"#show_more_comments_wrapper",comments:"#comments_list",commentForm:"#comment_form",commentMedia:"#media_id",commentText:"#comment_text",likeBlock:"#like_wrapper",commentBlock:"#comment_wrapper",likeBtn:".btn_like",followBtn:".btn_follow",followLink:".link_follow",commentBtn:".btn_comment",commentArea:"#comment_text",moreLessComments:".show_more_comments",moreComments:"#more_comments",lessComments:"#less_comments",pager:"#pager",more:".load_more",less:".load_less",slideshow:"#slideshow",prev:".prev_small",next:".next_small",prevThumb:".prev_large",nextThumb:".next_large",colorBox:".color_box",followError:"#follow_error",descShowMore:"#desc_show_more",description:".description",descShowMoreLinks:".desc_more",privateBlock:"#private_wrapper",reloadLink:"#reload_link",viewOnInstagram:".view_on_instagram",userName:".user_name"};var a={header:"header_template",followBlock:"follow_template",previewBlock:"preview_template",popupSection:"popup_template",previewInfo:"preview_info_template",previewImage:"preview_image_template",previewVideo:"preview_video_template",mediaInfoBlock:"media_info_template",descriptionBlock:"description_template",galleryBlock:"gallery_template",commentsBlock:"comments_template",showMoreCommentsBlock:"show_more_comments_template",comment:"comment_template",thumbnail:"image_template",likeBlock:"like_template",commentBlock:"comment_text_template",pager:"pager_template",more:"load_more_template",slideshow:"slideshow_template",styles:"custom_styles",privateBlock:"private_template",errorBlock:"error_template"};var c={mediator:b,regions:d,templates:a,minThumbs:1,maxThumbs:90,thumbSize:91,truncateLength:60,accessToken:null,isConnected:false,cookie:"PHPSESSID",latestNumThumbs:9};c.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};c.thumbsPerPage=function(){return c.pager&&c.pager.thumbsPerPage};c.getCurrentMedia=function(){return c.galleryMedias&&c.galleryMedias.getCurrentMedia()};c.computeMaxNumThumbs=function(){if(c.settings.layout==="thumb"){return c.computeGridMaxNumThumbs()}var e=$(".image_gallery"),j=c.thumbSize,g=c.thumbSize,i,h,f;i=e.height();h=e.width();f=Math.floor(i/j)*Math.floor(h/g);f=Math.min(Math.max(c.minThumbs,f),c.maxThumbs);return f};c.shouldFetch=function(){if(c.settings.layout==="thumb"){return c.gridShouldFetch()}var f=$(window).width(),e,g=false;if(f!==c.currentWidth){e=c.computeMaxNumThumbs();if(e!==c.thumbsPerPage()){c.pager.thumbsPerPage=e;g=true}}c.currentWidth=f;return g};c.computeGridMaxNumThumbs=function(){var f=$(d.header),g=$(window),l=$(d.imageGallery);var j=f.height(),e=g.height(),k=l.height(),n=$("#hidden_pager").height(),h=c.thumbSize;var m=l.width(),o=e-j-n;var i=Math.floor((o-70)/h)*Math.floor(m/h);i=Math.min(Math.max(c.minThumbs,i),c.maxThumbs);return i};c.gridShouldFetch=function(){var f=$(window).width(),e,g=false;e=c.computeGridMaxNumThumbs();if(e!==c.thumbsPerPage()){c.pager.thumbsPerPage=e;g=true}c.currentWidth=f;return g};c.parseMediaData=function(e){if(!e||!e.data){return}return e.data};c.loadCookieData=function(){var f=$.cookie(c.cookie),e=Routing.generate("session");if(f){$.post(e,{session_id:f},"json").done(function(g){c.user=new User(g.user);c.accessToken=g.access_token;c.isConnected=!!g.user}).fail(function(g){c.user=new User();c.accessToken=null;c.isConnected=false}).always(function(){b.publish("application:session:loaded")})}else{b.publish("application:session:loaded")}};c.setCookieData=function(e){if(!e){return $.removeCookie(this.cookie)}return $.cookie(this.cookie,JSON.stringify(e))};c.setWixHeight=function(f){var e=$("#container").height();if(f){e=Math.max(e,f)}Wix.setHeight(e)};c.isInWixEditor=function(){return Wix.Utils.getViewMode()!=="site"};c.isPrivateAccount=function(){return c.account.isPrivate&&!c.account.isFollowing};c.publishState=function(){Wix.PubSub.publish("application:loadState:response",{medias:c.galleryMedias.collection(),user:c.user,account:c.account,pager:c.pager,slideshow:c.slideshow,styles:c.styles})};c.createState=function(){return{medias:_.map(c.galleryMedias.collection(),function(e){return _.pick(e,"id")}),user:c.user,account:c.account,pager:c.pager,slideshow:c.slideshow,styles:c.styles}};c.wixPublish=function(e,f){Wix.PubSub.publish(e,_.extend({},f,{origCompId:c.origCompId}))};c.wixSubscribe=function(e,f){Wix.PubSub.subscribe(e,function(i){var h=i.data.origCompId,g=Wix.Utils.getCompId();if(h===g){f(i)}})};return c})();
(function UserModel(){var a=this,d=a.wixInstagramApp,b=d.mediator;var c;function e(f){this.id="";this.username="";this.description="";this.fullName="";this.website="";this.posts=0;this.followers=0;this.following=0;this.profilePic="http://placehold.it/70x70";this.isConnected=false;this.isFollowing=false;this.followed="";this.followAction="follow";this.followActionText="+ Follow";this.isPrivate=false;this.isObject=true;if(f){this.load(f)}}e.prototype.reset=function(){var g=new e(),f=this.mediator;return _.extend(this,g)};e.prototype.load=function(g){var h=g,k;var l,i,j,f;if(!g){return this}if(g.data){h=g.data}else{if(g.isObject){return _.extend(this,g)}}if(d.isConnected){l=h.isFollowing;i=h.followAction;j=h.isFollowing?"+ Follow":"Unfollow";f=h.isFollowing?"checked":""}else{l=false;i="follow";j="+ Follow";f=""}k={id:h.id,username:h.username,description:h.bio,fullName:h.full_name,website:h.website,profilePic:h.profile_picture,isFollowing:l,followAction:i,followActionText:j,posts:h.counts&&h.counts.media,followers:h.counts&&h.counts.followed_by,following:h.counts&&h.counts.follows,followed:f};return _.extend(this,k)};e.prototype.setRelation=function(f){c=this.followed;if(f&&f.outgoing_status==="follows"){this.isPrivate=f.target_user_is_private;this.isFollowing=true;this.followAction="unfollow";this.followActionText="Following";this.followed="checked"}else{if(f&&f.outgoing_status==="requested"){this.isPrivate=f.target_user_is_private;this.isFollowing=false;this.followAction="unfollow";this.followActionText="Requested";this.followed="requested"}else{this.isPrivate=f.target_user_is_private;this.isFollowing=false;this.followAction="follow";this.followActionText="+ Follow";this.followed=""}}b.publish("application:account:updated:relation",this.followed)};e.prototype.onFollowed=function(f){this.setRelation(f);if(f&&f.outgoing_status==="follows"){this.followers++}else{if(f&&f.outgoing_status==="none"){if(c==="checked"){this.followers--}}}b.publish("application:account:updated:followers",this.followed)};a.User=e}).call(this);
(function MediaModel(){var a=this,e=a.wixInstagramApp,d=e.mediator;function b(f){this.id="";this.type="image";this.likes=0;this.liked="";this.comments=0;this.createdDate="";this.location="";this.summary="";this.description="";this.image="http://placehold.it/640x640&text=No media available";this.thumbImage="http://placehold.it/75x75&text=No media available";this.video="";this.action="like";this.likeActionText="Like";this.commentsData={};this.commentList=[];this.isObject=true;this.link="";if(f){this.load(f)}}b.prototype.load=function(n){var h,k,v,m,t,p,r,i,u,j,s,l,f,o;var g=n,q;if(!n){return this}if(n.data){g=n.data}else{if(n.isObject){return _.extend(this,n)}}k=g.likes&&g.likes.count;m=g.comments&&g.comments.count;t=this.humanReadableDate(g.created_time);p=g.location&&g.location.name;r=g.caption&&g.caption.text;i=g.images&&g.images.standard_resolution.url;u=g.images&&g.images.thumbnail.url;l=g.commentList;f=g.videos&&g.videos.standard_resolution.url;o=g.link;if(e.isConnected){v=g.user_has_liked?"checked":"";j=g.user_has_liked?"unlike":"like";s=g.user_has_liked?"Unlike":"Like"}else{v="";j="like";s="Like"}q={liked:v,likes:k,comments:m,createdDate:t,location:this.truncate(p,60),summary:this.truncate(r,60),description:r,image:i,thumbImage:u,video:f,id:g.id,type:g.type,action:j,likeActionText:s,commentList:l,link:o};return _.extend(this,q)};b.prototype.humanReadableDate=function(g){var f=new Date(g*1000);return moment(f).fromNow()};b.prototype.likeUnlike=function(h,f){var g=f.data?f.data:f;if(!g){console.warn("Like: No mediaData found, aborting");return}this.likes=g.likes.count;this.liked=g.user_has_liked?"checked":"";this.action=g.user_has_liked?"unlike":"like";this.likeActionText=g.user_has_liked?"Unlike":"Like"};b.prototype.addComment=function(f){this.comments++;this.commentList.push(f)};b.prototype.truncate=function(g,f){if(!g){return""}if(g.length>f){return g.slice(0,f)+"..."}return g};function c(f){this._medias=[];this.current=0;if(f){this.load(f)}}c.prototype.load=function(g){var f=g;if(!g){return}if(g.data){f=g.data}this._medias.length=0;if(_.isArray(f)){_.each(f,function(h){this._medias.push(new b(h))},this)}else{this._medias.push(new b(f))}d.publish("application:gallery:updated",this)};c.prototype.collection=function(){return this._medias};c.prototype.append=function(f){var g=f;if(f instanceof c){g=f.collection()}_.each(g,function(h){if(h instanceof b){this._medias.push(h)}else{this._medias.push(new b(h))}},this);d.publish("application:gallery:updated",this)};c.prototype.remove=function(f){this._medias=_.initial(this._medias,f);d.publish("application:gallery:updated",this)};c.prototype.getCurrentMedia=function(){return this._medias[this.current]||new b()};c.prototype.getNextMedia=function(){if(this.isLast()){return null}return this._medias[this.current+1]||new b()};c.prototype.getPreviousMedia=function(){if(this.isFirst()){return null}return this._medias[this.current-1]||new b()};c.prototype.resetCurrentMedia=function(){this.current=0;return this.getCurrentMedia()};c.prototype.get=function(f){if(!this._medias||this._medias.length===0){console.warn("Invalid index",f);return}return this._medias[f]};c.prototype.set=function(f,g){if(f<0){console.warn("Invalid index",f)}this._medias[f]=g;d.publish("application:gallery:updated:new-media",this);return g};c.prototype.findMedia=function(g){if(!this._medias||this._medias.length===0){throw new Error("The media gallery is empty")}var f=_.findIndex(this._medias,{id:g});if(f===-1){console.warn("No media %s found in gallery",g);return}return this._medias[f]};c.prototype.indexOf=function(f){return _.findIndex(this._medias,{id:f})};c.prototype.isFirst=function(){return this.current===0};c.prototype.isLast=function(){if(this._medias.length===0){return true}return this.current===(this._medias.length-1)};c.prototype.advanceNext=function(){this.current++;if(this.current===this._medias.length){this.current=0}d.publish("application:current:updated",this.current)};c.prototype.advancePrevious=function(f){this.current--;if(this.current===-1){this.current=f?this._medias.length-1:0}d.publish("application:current:updated",this.current)};c.prototype.advanceTo=function(f){if(f<0){f=this._medias.length+f}this.current=f;d.publish("application:current:updated",this.current)};c.prototype.likeUnlikeMedia=function(i,g,f){var h=this.findMedia(i);if(h){h.likeUnlike(g,f);d.publish("application:current:liked",this.current)}else{console.warn("Could not like media %s: media not found",i)}};c.prototype.addComment=function(h,f){var g=this.findMedia(h);if(g){g.addComment(f);d.publish("application:current:new-comment",f)}else{console.warn("Could not comment media %s: media not found",h)}};a.Media=b;a.MediaCollection=c}).call(this);
(function(){var a=this,d=a.wixInstagramApp,c=d.mediator;function b(e){this.colors={background:{themeName:"color-1"},header:{themeName:"color-12"},separators:{themeName:"color-15"},bodyText:{themeName:"color-15"},headerText:{themeName:"color-15"},links:{themeName:"color-5"}};this.fonts={bodyFont:{preset:"Body-M"},headerFont:{preset:"Body-M"},linksFont:{preset:"Body-M"}};this.mediator=c;if(e){this.load(e)}}b.prototype.load=function(e){if(!e){return}_.extend(this.colors,e.colors);_.extend(this.fonts,e.fonts)};a.Styles=b}).call(this);
(function CommentModel(){var a=this,e=a.wixInstagramApp,b=e.mediator;function d(f,g){this.id="";this.mediaId=g||"";this.picture="";this.text="";this.fullName="";this.username="";this.createdTime="";this.userId="";this.isObject=true;if(f){this.load(f,g)}}d.prototype.load=function(g,j){var i,m,k,h,f;var l=g;if(!g){return this}if(g.data){l=g.data}else{if(g.isObject){return _.extend(this,g)}}i=l.from&&l.from.profile_picture;m=l.from&&l.from.username;k=l.from&&l.from.full_name;h=this.convertDateFromTimestamp(l.created_time);f=l.from&&l.from.id;return _.extend(this,{mediaId:j,picture:i,text:l.text,fullName:k,username:m,createdTime:h,userId:f})};d.prototype.convertDateFromTimestamp=function(f){return moment(f*1000).format("DD/MM/YYYY")};d.prototype.setUser=function(f){this.picture=f.profilePic;this.fullName=f.fullName;this.username=f.username;this.userId=f.id};function c(f){this.comments=[];this.isObject=true;if(f){this.load(f)}}c.prototype.load=function(g){var f=this,h=g;if(!g){return this}if(g.data){h=g.data}else{if(g.isObject){return _.extend(this,g)}}this.comments=[];_.each(h,function(i){f.comments.unshift(new d(i))});b.publish("application:comments:updated")};c.prototype.get=function(f){if(!this.comments||this.comments.length===0){console.error("Invalid index",f);return}return this.comments[f]};c.prototype.push=function(f){this.comments.unshift(f);b.publish("application:comments:created",f)};c.prototype.collection=function(){return this.comments};c.prototype.first=function(f){return _.first(this.comments,f)};a.Comment=d;a.CommentList=c}).call(this);
(function SlideshowModel(){var a=this,d=a.wixInstagramApp,c=d.mediator;function b(e){this.displayPrev=false;this.displayNext=true;this.isObject=true;if(e){this.load(e)}}b.prototype.load=function(e){if(e&&e.isObject){_.extend(this,e)}};b.prototype.updateDisplay=function(f,e){this.displayPrev=!(this.isFirstSlide(f)&&!this.hasPrevPage(e));this.displayNext=!(this.isLastSlide(f)&&!this.hasNextPage(e))};b.prototype.setSlide=function(f,e){f.advanceTo(f.indexOf(e));this.prev=f.getPreviousMedia();this.current=f.getCurrentMedia();this.next=f.getNextMedia()};b.prototype.setSlideByIndex=function(f,e){f.advanceTo(e);this.prev=f.getPreviousMedia();this.current=f.getCurrentMedia();this.next=f.getNextMedia()};b.prototype.previousSlide=function(e){e.advancePrevious(true);this.prev=e.getPreviousMedia();this.current=e.getCurrentMedia();this.next=e.getNextMedia();c.publish("application:slideshow:advanced:prev")};b.prototype.nextSlide=function(e){e.advanceNext();this.prev=e.getPreviousMedia();this.current=e.getCurrentMedia();this.next=e.getNextMedia();c.publish("application:slideshow:advanced:next")};b.prototype.isFirstSlide=function(e){return e&&e.isFirst()};b.prototype.isLastSlide=function(e){return e&&e.isLast()};b.prototype.hasPrevPage=function(e){return e&&!e.isFirstPage()};b.prototype.hasNextPage=function(e){return e&&!e.isLastPage()};b.prototype.loadPrevPage=function(e){e&&e.loadPrevPage()};b.prototype.loadNextPage=function(e){e&&e.loadNextPage()};a.Slideshow=b}).call(this);
(function PagerModel(){var a=this,d=a.wixInstagramApp,c=d.mediator;function b(e){this.pages=[];this.page=0;this.thumbsPerPage=8;this.next=void 0;this.current=void 0;this.prev=void 0;this.displayPrev=!!this.prev;this.displayNext=!!this.next;this.isObject=true;if(e){this.load(e)}}b.prototype.init=function(e){this.pages=[];this.page=0;this.next=e;this.current=void 0;this.prev=void 0;if(e){this.newPage(e)}this.updateDisplay();c.publish("application:pager:updated",this)};b.prototype.load=function(e){if(e&&e.isObject){_.extend(this,e)}};b.prototype.updateDisplay=function(){this.displayPrev=!this.isFirstPage();this.displayNext=!this.isLastPage()};b.prototype.previousPage=function(){if(this.isFirstPage()){return}this.page--;this.prev=this.pages[this.page-2];this.current=this.pages[this.page-1];this.next=this.pages[this.page];this.updateDisplay();c.publish("application:pager:previous",this)};b.prototype.nextPage=function(){if(this.isLastPage()){return}this.page++;this.prev=this.pages[this.page-2];this.current=this.pages[this.page-1];this.next=this.pages[this.page];this.updateDisplay();c.publish("application:pager:next",this)};b.prototype.isFirstPage=function(){return this.page===0};b.prototype.isLastPage=function(){return this.next===void 0};b.prototype.newPage=function(e){this.pages&&this.pages.push(e)};b.prototype.removePage=function(){return this.pages&&this.pages.pop()};b.prototype.goToNextPage=function(e){this.newPage(e);this.nextPage();c.publish("application:pager:updated",this)};b.prototype.goToPrevPage=function(){this.removePage();this.previousPage();c.publish("application:pager:updated",this)};a.Pager=b}).call(this);
(function InfinitePagerModel(){var a=this,d=a.wixInstagramApp,c=d.mediator;function b(e){this.numThumbs=0;this.first=0;this.current=0;this.next=void 0;this.displayNext=true;this.isObject=true;if(e&&e.isObject){_.extend(this,e)}}b.prototype.load=function(f,e){this.next=f;this.numThumbs=e;this.updateDisplay();c.publish("application:pager:updated",this)};b.prototype.updateDisplay=function(){this.displayNext=!this.isLastPage()};b.prototype.goToNextPage=function(e){this.current=this.next;this.next=e;c.publish("application:pager:more",this)};b.prototype.isFirstPage=function(){return this.current===this.first};b.prototype.isLastPage=function(){return this.current===this.next};b.prototype.newPage=function(e){return this.goToNextPage(e)};b.prototype.removePage=function(){return null};a.InfinitePager=b}).call(this);
(function AjaxHelper(){var g=this,b=g.wixInstagramApp,a=b.mediator,h={},d={};var f=Wix.Utils.getInstanceId(),j=Wix.Utils.getCompId(),k=Wix.Utils.getOrigCompId();h.setSettings=function(){d=b.settings};h.deleteSettings=function(){var m=Routing.generate("deleteSettings",{instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.ajax({url:m,type:"DELETE"}).done(function(n){l.resolve(n)}).fail(function(n){l.reject(n)});return l.promise()};function e(){if(d.gallery_source==="account"){return Routing.generate("medias",{userId:d.instagram_id,instanceId:f,compId:j,origCompId:k})}else{if(d.gallery_source==="tag"){return Routing.generate("tags",{tag:d.hash_tag,instanceId:f,compId:j,origCompId:k})}else{throw new Error("Invalid gallery source",d.gallery_source)}}}h.fetchSocial=function(){var m=Routing.generate("userinfo",{userId:d.instagram_id,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.get(m,"json").done(function(n){a.publish("application:social-fetched",n);l.resolve(n)}).fail(function(p,o,n){console.warn("Could not fetch user info",n);a.publish("application:ajax:error",n,p.responseText,"application:ajax:fetchSocial");l.reject(n)});return l.promise()};h.fetchMedias=function(n){var m=e(),l=$.Deferred();$.ajax(m,{beforeSend:i,complete:c,data:{count:b.pager.thumbsPerPage},contentType:"json"}).done(function(o){var r=b.parseMediaData(o),q=o.pagination&&o.pagination.next_max_id,p=-1;if(n){p=_.findIndex(o.data,function(s){return s.id===n})}if(p===-1){p=0}a.publish("application:media-fetched:init",r,q,p);l.resolve(r,q,p)}).fail(function(q,p,o){console.warn("Error fetching medias",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:fetchMedias");l.reject(o)});return l.promise()};h.fetchMedia=function(n){var m=Routing.generate("media",{mediaId:n,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.get(m,"json").done(function(o){a.publish("application:media-fetched:media",o.data);l.resolve(o.data)}).fail(function(q,p,o){console.warn("Error fetching medias",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:fetchMedia");l.reject(o)});return l.promise()};h.fetchMediaFrom=function(n){var m=e(),l=$.Deferred();$.ajax(m,{beforeSend:i,complete:c,data:{from:n,count:b.pager.thumbsPerPage,instance:b.instance},contentType:"json"}).done(function(o){var r=b.parseMediaData(o),q=o.pagination&&o.pagination.next_max_id,p=0;a.publish("application:media-fetched:init",r,q,p);l.resolve(r,q,p)}).fail(function(q,p,o){console.warn("Error fetching medias",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:fetchMediaFrom");l.reject(o)});return l.promise()};h.fetchMediaTo=function(n){var m=e(),l=$.Deferred();$.ajax(m,{beforeSend:i,complete:c,data:{count:"-1",to:n},contentType:"json"}).done(function(o){var r=b.parseMediaData(o),q=o.pagination&&o.pagination.next_max_id,p=r.length-1;a.publish("application:media-fetched:to",r,q,p);l.resolve(r,q,p)}).fail(function(q,p,o){console.warn("Error fetching medias",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:fetchMediaTo");l.reject(o)});return l.promise()};h.fetchMoreComments=function(o){var n=o.id,m=Routing.generate("comments",{mediaId:n,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.ajax(m,{contentType:"json"}).done(function(p){a.publish("application:comments-fetched",p,o);l.resolve(p,o)}).fail(function(r,q,p){a.publish("application:ajax:error",p,r.responseText,"application:ajax:fetchMoreComments");l.reject(p)});return l.promise()};h.fetchRelationship=function(m){var o=m.id,n=Routing.generate("relationship",{userId:o,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.get(n,"json").done(function(p){a.publish("application:relation-fetched",p);l.resolve(p)}).fail(function(r,q,p){console.warn("Error fetching relationship for this user");a.publish("application:ajax:error",p,r.responseText,"application:ajax:fetchRelationship");l.reject(p)});return l.promise()};h.fetchCurrent=function(o,l){var n=e(),m=$.Deferred();$.ajax(n,{beforeSend:i,complete:c,data:{from:l,count:b.pager.thumbsPerPage},contentType:"json"}).done(function(p){var s=b.parseMediaData(p),r=p.pagination&&p.pagination.next_max_id,q=_.findIndex(s,function(t){return t.id===o});a.publish("application:media-fetched:current",s,r,q||0);m.resolve(s,r)}).fail(function(r,q,p){console.warn("Error fetching medias",p);a.publish("application:ajax:error",p,r.responseText,"application:ajax:fetchCurrent");m.reject(p)});return m.promise()};h.fetchNext=function(n,o){var m=e(),l=$.Deferred();$.ajax(m,{beforeSend:i,complete:c,data:{from:o,count:b.pager.thumbsPerPage},contentType:"json"}).done(function(p){var r=b.parseMediaData(p),q=p.pagination&&p.pagination.next_max_id;a.publish("application:media-fetched:next",r,q,n||0);l.resolve(r,q)}).fail(function(r,q,p){console.warn("Error fetching medias",p);a.publish("application:ajax:error",p,r.responseText,"application:ajax:fetchNext");l.reject(p)});return l.promise()};h.fetchPrev=function(n,o){var m=e(),l=$.Deferred();$.ajax(m,{beforeSend:i,complete:c,data:{from:o,count:b.pager.thumbsPerPage},contentType:"json"}).done(function(p){var r=b.parseMediaData(p),q=p.pagination&&p.pagination.next_max_id;a.publish("application:media-fetched:prev",r,q,n||0);l.resolve(r,q)}).fail(function(r,q,p){console.warn("Error fetching medias",p);a.publish("application:ajax:error",p,r.responseText,"application:ajax:fetchPrev");l.reject(p)});return l.promise()};h.fetchMore=function(n){var m=e(),l=$.Deferred();$.ajax(m,{beforeSend:i,complete:c,data:{from:n,count:b.pager.thumbsPerPage},contentType:"json"}).done(function(o){var q=b.parseMediaData(o),p=o.pagination&&o.pagination.next_max_id;a.publish("application:media-fetched:more",q,p);l.resolve(q,p)}).fail(function(q,p,o){console.warn("Error fetching medias",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:fetchMore");l.reject(o)});return l.promise()};h.likeUnlike=function(o,n){var m=Routing.generate("like",{media_id:o,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();a.publish("application:events:like",o,n);$.post(m,{action:n},"json").done(function(p){l.resolve();a.publish("application:media:like",o,n,p)}).fail(function(r,q,p){console.warn("There was an error during the liking process");a.publish("application:ajax:error",p,r.responseText,"application:ajax:likeUnlike");l.reject(p)});return l.promise()};h.followUnfollow=function(n){var m=Routing.generate("follow",{userId:d.instagram_id,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.post(m,{action:n},"json").done(function(o){l.resolve(o);a.publish("application:user:followed",n,o.data)}).fail(function(q,p,o){console.warn("There was an error during the following process");a.publish("application:ajax:error",o,q.responseText,"application:ajax:followUnfollow");l.reject(o)});return l.promise()};h.comment=function(o,n){var m=Routing.generate("comment",{media_id:n.id,instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.post(m,{comment:o},"json").done(function(){a.publish("application:comment:post",o,n);l.resolve(o,n)}).fail(function(r,q,p){console.warn("There was an error during the comment process");l.reject(p)});return l.promise()};h.saveState=function(n){var m=Routing.generate("save_state",{instanceId:f,compId:j,origCompId:k}),l=$.Deferred();$.post(m,{state:n},"json").done(function(o){l.resolve(o)}).fail(function(q,p,o){console.warn("Error",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:saveState");l.reject(o)});return l.promise()};h.loadState=function(n){var m=Routing.generate("load_state",{instanceId:f,compId:j,origCompId:k,sessionId:n}),l=$.Deferred();$.get(m,"json").done(function(o){l.resolve(o)}).fail(function(q,p,o){console.warn("Error",o);a.publish("application:ajax:error",o,q.responseText,"application:ajax:loadState");l.reject(o)});return l.promise()};function i(){$("#loader").removeClass("hidden").spin("small","white")}function c(){$("#loader").addClass("hidden").spin(false)}h.showLoader=i;h.stopLoader=c;b.ajaxHelper=h;return h}).call(this);
(function LoginHelper(){var h=this,b=h.wixInstagramApp,a=b.mediator,d=b.regions,i=b.ajaxHelper,f=$.Deferred();function e(q,o){function r(s){}function p(s){}var n={};switch(q){case"LIKE":n={type:Wix.Activities.Type.CONVERSION_COMPLETE,info:{conversionType:"LIKE",metadata:[{name:"user_name",value:o.user_name},{name:"item_description",value:o.item_description}]}};break;case"FOLLOW":n={type:Wix.Activities.Type.CONVERSION_COMPLETE,info:{conversionType:"FOLLOW"}};break;case"COMMENT":n={type:Wix.Activities.Type.CONVERSION_COMPLETE,info:{conversionType:"COMMENT",metadata:[{name:"user_name",value:o.user_name},{name:"item_description",value:o.item_description},{name:"commenter_username",value:o.user_name},{name:"comment_data",value:o.comment_data}]}};break}Wix.Activities.postActivity(n,r,p)}function j(o){var n=$(o.currentTarget),q=n.data("id"),p=n.data("action");o.preventDefault();if(b.isConnected){f.resolve(b.user)}else{a.publish("application:login:authenticate")}f.promise().done(function(){i.likeUnlike(q,p);if(p==="like"&&Wix.Utils.getViewMode()!=="preview"){e("LIKE",{user_name:b.account.username,item_description:"User clicked like."})}}).fail(function(r){console.error(r)})}function l(n){var o;n.preventDefault();if(b.isConnected){f.resolve(b.user)}else{a.publish("application:login:authenticate")}f.promise().done(function(){if(b.account.username===b.user.username){m();return}o=b.account.followAction;i.followUnfollow(o);if(Wix.Utils.getViewMode()!=="preview"){e("FOLLOW",[])}}).fail(function(p){console.error(p)})}function k(n,o){if(b.isConnected){f.resolve()}else{a.publish("application:login:authenticate")}f.promise().done(function(){i.comment(n,o);if(Wix.Utils.getViewMode()!=="preview"){e("COMMENT",{user_name:b.account.username,item_description:"User added a comment.",commenter_username:b.user.username,comment_data:n})}}).fail(function(r,q,p){console.error(p)})}function g(o){var r,q=window.screen.width,u=window.screen.height;var n=1000,p=800,t=(q/2)-(n/2),s=(u/2)-(p/2);r=window.open(o,"Login","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+n+", height="+p+", top="+s+", left="+t);if(r){r.moveTo&&r.moveTo(t,s);r.focus&&r.focus()}}function c(){var n=Routing.generate("login",{instance:b.instance});g(n)}function m(){$(d.followError).show();setTimeout(function(){$(d.followError).hide()},5000);console.warn("You can't follow yourself!");a.publish("application:user:ownfollow")}a.subscribe("application:login:authenticate",function(){c()});a.subscribe("application:events:connected",function(n){var o=Routing.generate("save_session");$.post(o,{data:JSON.stringify(n)},"json").done(function(p){a.publish("application:session:saved",p);f.resolve(p.user)}).fail(function(){a.publish("application:session:deleted");f.reject()})});b.loginHelper={handleLike:j,handleComment:k,handleFollow:l}}).call(this);
(function WixMediatorHelper(){var a=this,f=a.wixInstagramApp,e=f.mediator;function d(){var g=$.Deferred();c("application:loadState:request");Wix.PubSub.subscribe("application:loadState:response",function(h){var i=h.data;if(!i){throw new Error("Could not retrieve state")}g.resolve(i)});return g.promise()}function c(g,h){Wix.PubSub.publish(g,_.extend({},h,{origCompId:f.origCompId}))}function b(g,h){Wix.PubSub.subscribe(g,function(k){var j=k.data.origCompId,i=Wix.Utils.getCompId();if(j===i){h(k)}})}f.wixMediator={loadState:d,wixPublish:c,wixSubscribe:b}}).call(this);
(function PagerView(){var g=this,c=g.wixInstagramApp,a=c.mediator,d=c.regions,j=c.templates,h=c.ajaxHelper;function e(){f()}function i(){var l=$(d.galleryBlock);l.on("click",d.next,function(){a.publish("application:gallery:next",0)});l.on("click",d.prev,function(){a.publish("application:gallery:prev",0)})}function b(){var m=$(d.pager);var l=tmpl(j.pager,c.pager);m.html(l).hide()}function k(){var l=$(d.pager);l.fadeIn(function(){a.publish("application:rendered:pager")})}function f(){a.subscribe("application:init",i);a.subscribe("application:pager:updated",b);a.subscribe("application:rendered:gallery",k)}c.pagerView={initialize:e,render:b}}).call(this);
(function LoadMoreView(){var g=this,c=g.wixInstagramApp,a=c.mediator,d=c.regions,j=c.templates,h=c.ajaxHelper;function e(){f()}function i(){var l=$(d.galleryBlock);l.on("click",d.less,function(){a.publish("application:gallery:less")});l.on("click",d.more,function(){a.publish("application:gallery:more")})}function b(){var m=$(d.pager);var l=tmpl(j.more,c.pager);m.html(l).hide();a.publish("application:rendered:pager")}function k(){var l=$(d.pager);l.fadeIn(function(){a.publish("application:rendered:pager")})}function f(){a.subscribe("application:init",i);a.subscribe("application:pager:updated",b);a.subscribe("application:rendered:gallery",k)}c.loadMoreView={initialize:e,render:b}}).call(this);
(function CommentsView(){var r=this,k=r.wixInstagramApp,l=k.mediator,b=k.regions,d=k.templates,n=k.loginHelper;function a(){c()}function m(){var v=$(b.mainImageWrapper);v.on("click",b.moreComments,p);v.on("click",b.lessComments,g);v.on("keydown",b.commentArea,f);v.on("focus",b.commentArea,j)}function j(){var v=$(b.commentArea);if(v.length<=0){console.warn("Cannot find the comment textarea. Aborting");return}v.autosize({callback:function(){l.publish("application:resized:textarea")}})}function p(w){var v=k.getCurrentMedia();w.preventDefault();if(k.moreLoaded){k.showAllComments=true;u()}else{l.publish("application:comments:more",v)}}function g(v){v.preventDefault();k.showAllComments=false;u()}function f(v){var x,w;if(v.keyCode===13&&v.shiftKey===false){v.preventDefault();x=$(b.commentText).val().trim();if(!x){return}w=k.getCurrentMedia();l.publish("application:comment:submit",x,w)}v.stopPropagation()}function s(){var w=$(b.commentsBlock),v=$(b.showMoreCommentsBlock);k.getCurrentMedia().showMore=k.showAllComments;w.html(tmpl(d.commentsBlock,k.getCurrentMedia()));v.html(tmpl(d.showMoreCommentsBlock,k.getCurrentMedia()))}function e(){var w=$(b.comments),v=k.comments,x;if(w.length<=0){return}w.empty();x=v.collection();$.each(x,function(y,z){q(z,w)});l.publish("application:rendered:comments")}function q(x,v){var w=tmpl(d.comment,x);v.append(w)}function h(w,v){return w.prependTo(v).hide().slideDown()}function o(w){var v=k.comments.collection().length;if(!k.showAllComments){}return _.noop()}function i(x){var w=$(b.comments),v;if(w.length<=0){console.warn("Could not find comments container");return}v=$(tmpl(d.comment,x));$.when(h(v,w)).then(o($(".comment:last-child"))).then(function(){l.publish("application:rendered:comments")})}function t(){var v=$(b.commentText);if(v.length>0){v.val("").trigger("autosize.resize")}}function u(){s();e()}function c(){l.subscribe("application:init",m);l.subscribe("application:comment:submit",function(w,v){t();n.handleComment(w,v)});l.subscribe("application:comments:updated",function(){u()});l.subscribe("application:comments:created",function(v){i(v)})}k.commentsView={initialize:a,render:u}}).call(this);
(function SlideshowView(){var l=this,g=l.wixInstagramApp,c=g.mediator,h=g.regions,o=g.templates,m=g.ajaxHelper;function j(){k()}function n(){var p=$(h.slideshow);if(p.length<=0){return}p.on("click",h.nextThumb,i);p.on("click",h.prevThumb,e);$(document).on("keydown",d)}function b(r,q){var p=$(h.slideshow);p.off("click");p.on("click touchend",h.nextThumb,i);p.on("click touchend",h.prevThumb,e)}function i(p){p.preventDefault();if(g.slideshow.isLastSlide(g.galleryMedias)){if(g.slideshow.hasNextPage(g.pager)){c.publish("application:gallery:next",0)}}else{c.publish("application:slideshow:next")}}function e(p){p.preventDefault();if(g.slideshow.isFirstSlide(g.galleryMedias)){if(g.slideshow.hasPrevPage(g.pager)){c.publish("application:gallery:prev",-1)}}else{c.publish("application:slideshow:prev")}}function d(p){if(p.keyCode===37){e(p)}else{if(p.keyCode===39){i(p)}}}function f(){var p=$(h.slideshow);if(p.length<=0){return}g.slideshow.updateDisplay(g.galleryMedias,g.pager);var q=tmpl(o.slideshow,g.slideshow);p.html(q).hide();return p}function a(){var p=$(h.slideshow);p.fadeIn()}function k(){c.subscribe("application:init",n);c.subscribe("application:init",b,{predicate:g.isMobile});c.subscribe("application:current:updated",f);c.subscribe("application:rendered:preview",a)}g.slideshowView={initialize:j,render:f}}).call(this);
(function HeaderView(){var j=this,d=j.wixInstagramApp,a=d.mediator,g=d.regions,l=d.templates,b=d.loginHelper;function h(){d.account=d.account||new User();i()}function k(){var n=$(g.header);n.on("click",g.followBtn,b.handleFollow);n.on("click",g.userName,m)}function m(s){var p,u,n=window.screen.width,o=window.screen.height;var v=960,r=600,q=(n/2)-(v/2),t=(o/2)-(r/2);s.preventDefault();p=$(this).data("href");u=window.open(p,"User Name","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+v+", height="+r+", top="+t+", left="+q);if(u){u.moveTo&&u.moveTo(q,t);u.focus&&u.focus()}}function e(){var n=$(g.followBlock);if(n.length<=0){console.warn("Cannot find the follow button");return}n.html(tmpl(l.followBlock,d.account));a.publish("application:header:rendered",d.account)}function f(){var n=$(g.header);if(n.length<=0){console.warn("Cannot find the header. Aborting");return}n.html(tmpl(l.header,d.account));a.publish("application:header:rendered",d.account)}function c(){f();e()}function i(){a.subscribe("application:init",k);a.subscribe("application:account:updated",c)}d.headerView={initialize:h,render:c}}).call(this);
(function PreviewView(){var x=this,k=x.wixInstagramApp,l=k.mediator,b=k.regions,e=k.templates,s=k.loginHelper;var m=false,z=0;function a(){d()}function r(){var E=$(b.previewSection);E.on("click touchend",b.likeBtn,s.handleLike);E.on("submit",b.commentForm,s.handleComment);E.on("click touchend",b.videoButton,n);E.on("click",b.viewOnInstagram,h)}function h(J){var G,L,E=window.screen.width,F=window.screen.height;var M=960,I=840,H=(E/2)-(M/2),K=(F/2)-(I/2);J.preventDefault();G=$(this).data("href");L=window.open(G,"Media","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+M+", height="+I+", top="+K+", left="+H);if(L){L.moveTo&&L.moveTo(H,K);L.focus&&L.focus()}}function q(){var G=$("#video_container"),E=$(b.video);if(G.length<=0){return}var F=E.data("src"),H=E.data("poster");E.jPlayer({ready:function(){$(this).jPlayer("setMedia",{m4v:F,poster:H})},loadedmetadata:function(I){l.publish("application:video:loaded",I)},click:function(I){l.publish("application:video:toggled",I)},pause:function(I){l.publish("application:video:paused",I)},size:{width:"100%",height:"inherit",cssClass:"video_element"},preload:"auto",cssSelectorAncestor:"#video_container",solution:"html, flash",swfPath:"/Resources",wmode:"window",supplied:"m4v"})}function u(G){var F=G.jPlayer;if(!F){console.warn("Error: jPlayer is not initialized");return}if(/iPod|iPhone|iPad/g.test(navigator.userAgent)){var E=$("video")[0];if(F.status.paused){E.load();E.play()}else{E.pause()}}else{if(F.status.paused){$(b.video).jPlayer("play")}else{$(b.video).jPlayer("pause")}}}function n(){var H=$(b.previewBlock);if(H.length<=0){return}var G=H.find(b.previewVideo),E=H.find(b.videoContainer),F=E.find(b.video);G.hide();E.show();$(b.video).jPlayer("play")}function o(F){var E=$(b.videoContainer),G=E.data("position")||0;$(b.video).jPlayer("play",G)}function j(G){var F=/(iPhone|iPod|iPad)/g.test(navigator.userAgent),E=G.jPlayer&&G.jPlayer.flash&&G.jPlayer.flash.used;return F||E}function B(F){var H=$(b.videoContainer),G=$(b.previewVideo);var E=F.jPlayer&&F.jPlayer.status.currentTime;H.data("position",E);H.hide();G.show();Wix.scrollTo(0,0)}function i(){var E=$(b.video),F=$(b.previewVideo);if(/(iPhone|iPod|iPad)/g.test(navigator.userAgent)){F.hide();E.show()}}function w(){var F=$(b.preview),E=$(b.previewImage),G=$(b.previewInfo);E.hide();G.hide();F.spin("small")}function y(){var E=$(b.preview),F=$(b.previewInfo);if(E.length<=0||F.length<=0){return}F.hide();E.spin("small");v().done(function(){q();D();t();g();l.publish("application:rendered:preview",k.getCurrentMedia());F.slideDown(function(){l.publish("application:rendered:comments")})}).fail(function(){console.error("Error loading image")}).always(function(){E.spin(false)})}function v(){var G=$(b.previewImage),E,F=k.getCurrentMedia(),H=$.Deferred();if(G.length<=0){console.warn("Cannot find main image container");H.reject()}G.hide();if(F){if(F.type==="image"){E=e.previewImage}else{if(F.type==="video"){E=e.previewVideo}}}else{E=e.noImage;F=new Media()}G.html(tmpl(E,F));G.imagesLoaded().done(function(){G.show();$(b.preview).hide().fadeIn("normal");H.resolve()});return H.promise()}function D(){var E=$(b.mediaInfoBlock),F;if(E.length<=0){console.warn("Could not find media info container");return}F=tmpl(e.mediaInfoBlock,k.getCurrentMedia());E.html(F);return E}function t(){var F=$(b.descriptionBlock),E;if(F.length<=0){console.warn("Could not find description container");return}E=tmpl(e.descriptionBlock,k.getCurrentMedia());F.html(E);return F}function C(){var E=$(b.likeBlock),F;if(E.length<=0){console.warn("Could not find like block");return}F=tmpl(e.likeBlock,k.getCurrentMedia());E.html(F);return E}function f(){var F=$(b.commentBlock),E;if(F.length<=0){console.warn("Could not find comment block");return}E=tmpl(e.commentBlock,k.getCurrentMedia());F.html(E);return F}function p(){D();C()}function g(){C();f()}function A(){$(b.aside).show()}function c(){return k.getCurrentMedia().image}function d(){l.subscribe("application:init",r);l.subscribe("application:slideshow:advanced",w);l.subscribe("application:current:updated",y,{predicate:c});l.subscribe("application:current:liked",p);l.subscribe("application:current:new-comment",p);l.subscribe("application:rendered:preview",A);l.subscribe("application:video:toggled",u);l.subscribe("application:video:paused",B,{predicate:j})}k.previewView={initialize:a,render:y}}).call(this);
(function PrivateView(){var h=this,d=h.wixInstagramApp,a=d.mediator,e=d.regions,j=d.templates,b=d.loginHelper;function f(){g()}function i(){var k=$(e.main);k.on("click",e.followLink,b.handleFollow)}function c(){var k=tmpl(j.privateBlock,d.account);$(e.layout).replaceWith(k);a.publish("application:private:rendered")}function g(){a.subscribe("application:init",i);a.subscribe("application:account:updated",c,{predicate:d.isPrivateAccount});a.subscribe("application:private:render",c)}d.privateView={initialize:f,render:c}}).call(this);
(function ErrorView(){var g=this,c=g.wixInstagramApp,a=c.mediator,d=c.regions,i=c.templates;function e(){f()}function h(){var j=$(d.main);j.on("click touchend",d.reloadLink,function(){window.location.reload()})}function b(j,m){var l={error:j,action:m};var k=tmpl(i.errorBlock,l);$(d.layout).replaceWith(k)}function f(){a.subscribe("application:init",h);a.subscribe("application:errorPage:render",b)}c.errorView={initialize:e,render:b}}).call(this);
(function PopupView(){var i=this,c=i.wixInstagramApp,a=c.mediator,d=c.regions,k=c.ajaxHelper;function e(){h()}function l(){var m=$(d.grid),n=$(d.previewSection);m.on("click",d.thumbImage,j);$(document).on("keydown",b);n.on("click",d.viewOnInstagram,g)}function g(r){var o,t,m=window.screen.width,n=window.screen.height;var u=960,q=840,p=(m/2)-(u/2),s=(n/2)-(q/2);r.preventDefault();o=$(this).data("href");t=window.open(o,"Media","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+u+", height="+q+", top="+s+", left="+p);if(t){t.moveTo&&t.moveTo(p,s);t.focus&&t.focus()}}function j(m){k.saveState(JSON.stringify(c.createState())).then(function(o){var p=$(m.target).data("id");var n=Routing.generate("desktop_modal",{mediaId:p,session_id:o.session_id},true);Wix.openModal(n,960,640)})}function b(m){if(m.keyCode===27){Wix.closeWindow()}}function f(o){var n=$(o),m=n.data("jsp");if(m){m.destroy()}if($(o).height()>=184){$(o).jScrollPane({mouseWheelSpeed:40})}}function h(){a.subscribe("application:init",l);a.subscribe("application:current:updated",function(){$(d.aside).hide()});a.subscribe("application:rendered:preview",function(){f(d.sideHeader);$(d.aside).show()})}c.popupView={initialize:e,showPopup:j}}).call(this);
(function ModalView(){var g=this,c=g.wixInstagramApp,a=c.mediator,d=c.regions,i=c.ajaxHelper,b=c.loginHelper;function e(){f()}function j(){var k=$(d.grid),l=$(d.previewSection);k.on("click",d.thumbImage,h);l.on("click",d.likeBtn,b.handleLike);l.on("submit",d.commentForm,b.handleComment)}function h(k){i.saveState(JSON.stringify(c.createState())).then(function(n){var o=$(k.target).data("id");var l=Routing.generate("modal",{mediaId:o,session_id:n.session_id},true);var m=/iPhone|iPod/.test(navigator.platform);if(m){Wix.openModal(l,window.innerWidth,window.innerHeight)}else{Wix.openModal(l)}})}function f(){a.subscribe("application:init",function(){j()})}c.modalView={initialize:e,showPopup:h}}).call(this);
(function GalleryView(){var j=this,d=j.wixInstagramApp,a=d.mediator,m=d.templates,e=d.regions;function g(){h()}function l(){var n=$(e.galleryBlock);n.on("click",e.thumbImage,f)}function f(n){var q=$(n.target),p=q.data("id"),o;n.preventDefault();if(!p){console.warn("There was no id defined for the selected thumb");return}i(p);a.publish("application:thumb:selected",p)}function i(o){if(d.layout&&d.layout!=="thumb"){var n=document.getElementById(o);if(n){$(n).siblings().removeClass("active");$(n).addClass("active")}}}function c(n,p,o){b()}function b(){var n=$(e.gallery),p=$(e.galleryBlock),o=d.getCurrentMedia();if(n.length<=0||p.length<=0){console.warn("Could not find gallery");return}n.empty();n.hide();_.each(d.galleryMedias.collection(),function(q){k(q,n)});p.spin("small");n.imagesLoaded().done(function(){p.spin(false);n.fadeIn();a.publish("application:rendered:gallery")})}function k(p,n){var o;o=tmpl(m.thumbnail,p);n.append(o)}function h(){a.subscribe("application:init",l);a.subscribe("application:gallery:updated",b);a.subscribe("application:current:updated",function(){var n=d.getCurrentMedia().id;i(n)})}d.galleryView={initialize:g,render:b}}).call(this);
(function MainController(){var j=this,e=j.wixInstagramApp,a=e.mediator,k=e.ajaxHelper,b=e.loginHelper,f=e.regions;function d(){e.account=e.account||new User();e.user=e.user||new User();e.galleryMedias=e.galleryMedias||new MediaCollection();e.comments=e.comments||new CommentList();e.pager=e.pager||new Pager();e.slideshow=e.slideshow||new Slideshow()}function h(m){m=m||{};d();e.settings=_.extend({},e.settings,m.settings);k.setSettings();e.account.load(m.account);e.user.load(m.user);e.galleryMedias.load(m.medias);e.comments.load(m.comments);e.pager.load(m.pager);e.slideshow.load(m.slideshow);e.origCompId=Wix.Utils.getOrigCompId()}function l(m){Wix.scrollTo(0,0);a.publish("application:events:connected",m)}function i(){a.subscribe("application:ajax:error",function(n,p,o){var m=JSON.parse(p);if(m.meta&&m.meta.error_type==="APINotAllowedError"){a.publish("application:private:render");return}a.publish("application:errorPage:render",n,o)});a.subscribe("application:media-fetched:init",function(m,o,n){e.pager.init(o);e.galleryMedias.load(m);e.slideshow.setSlideByIndex(e.galleryMedias,n)});a.subscribe("application:media-fetched:current",function(m,o,n){e.galleryMedias.load(m);e.slideshow.setSlideByIndex(e.galleryMedias,n)});a.subscribe("application:media-fetched:next",function(m,o,n){e.pager.goToNextPage(o);e.galleryMedias.load(m);e.slideshow.setSlideByIndex(e.galleryMedias,n)});a.subscribe("application:media-fetched:prev",function(m,o,n){e.pager.goToPrevPage();e.galleryMedias.load(m);e.slideshow.setSlideByIndex(e.galleryMedias,n)});a.subscribe("application:media-fetched:more",function(m,n){e.pager.goToNextPage(n);e.galleryMedias.append(m);e.latestNumThumbs=m.length});a.subscribe("application:media-fetched:less",function(){e.pager.goToPrevPage(e.pager.current);e.galleryMedias.remove(e.latestNumThumbs||9);e.latestNumThumbs=9});a.subscribe("application:media-fetched:media",function(n){var m=e.galleryMedias.indexOf(n.id);if(m===-1){e.galleryMedias.load(n);e.galleryMedias.resetCurrentMedia()}else{var o=new Media(n);e.galleryMedias.set(m,o);e.slideshow.setSlideByIndex(e.galleryMedias,m)}});a.subscribe("application:current:updated",function(){var m=e.getCurrentMedia();e.showAllComments=false;e.moreLoaded=false;e.comments.load(m.commentList)});a.subscribe("application:comments-fetched",function(m){e.showAllComments=true;e.moreLoaded=true;e.comments.load(m)});a.subscribe("application:thumb:selected",function(m){e.slideshow.setSlide(e.galleryMedias,m)});a.subscribe("application:slideshow:next",function(){e.slideshow.nextSlide(e.galleryMedias)});a.subscribe("application:slideshow:prev",function(){e.slideshow.previousSlide(e.galleryMedias)});a.subscribe("application:gallery:next",function(m){k.fetchNext(m,e.pager.next)});a.subscribe("application:gallery:prev",function(m){k.fetchPrev(m,e.pager.prev)});a.subscribe("application:gallery:less",function(m){a.publish("application:media-fetched:less")});a.subscribe("application:gallery:more",function(m){k.fetchMore(e.pager.next)});a.subscribe("application:comments:more",function(m){k.fetchMoreComments(m)});a.subscribe("application:media:like",function(o,n,m){e.galleryMedias.likeUnlikeMedia(o,n,m)});a.subscribe("application:user:followed",function(m,n){e.account.onFollowed(n)});a.subscribe("application:comment:post",function(m,o){var n={text:m,from:e.user},p;e.galleryMedias.addComment(o.id,n);p=new Comment(n);e.comments.push(p)});a.subscribe("application:session:saved",function(m){e.accessToken=m.access_token;e.user.load(m.user);e.isConnected=true});a.subscribe("application:session:deleted",function(){console.warn("Login failed");e.accessToken=null;e.user.reset();e.isConnected=false});Wix.addEventListener(Wix.Events.COMPONENT_DELETED,function(){g();var m="isModalDismissed-"+Wix.Utils.getCompId();localStorage.removeItem(m)})}function g(){return k.deleteSettings()}function c(m){h(m);i();e.loadCookieData()}e.mainController={initialize:h,start:c,connect:l}}).call(this);